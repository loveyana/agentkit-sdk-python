# AgentKit Built-in Tools 快速开始指南

Built-in Tools是AgentKit内置的All-in-one的工具，提供了多种Agent在执行任务中需要的运行环境工具，支持快速集成与便捷调用。

## 核心能力
  - 提供code sandbox能力，让Agent安全地“运行代码”
  - 提供browser sandbox能力：让Agent“像人一样操作网页”
  - 提供terminal sandbox能力：让Agent“像人一样操作操作系统控制台（Terminal）”
  - 提供文件系统能力：让Agent上传、下载文件

本文档将详细介绍如何在智能体代码中集成和使用 Built-in Tools，特别是代码执行沙箱功能。通过本指南，您将学会如何创建、配置和调用沙箱工具。

## 前置准备：创建沙箱工具

在开始编写代码之前，您需要先在火山引擎控制台创建一个沙箱工具实例：

1. 访问 [Agentkit Built-in Tools 控制台](https://console.volcengine.com/agentkit-stg/region:agentkit-stg+cn-beijing/builtintools)
2. 创建新的沙箱工具实例
3. 记录生成的 `TOOL_ID`，后续配置中会用到

## 智能体代码示例(使用VeADK框架)

[VeADK](https://github.com/volcengine/veadk-python)是一个开源的智能体开发框架，提供了智能体的开发、运行、调试等功能，由火山引擎团队维护。
以下示例代码会展示如何使用VeADK框架来快速构建一个具备代码执行能力的智能体，通过集成Built-in Tools中的`run_code`工具，实现智能体在沙箱环境中安全地执行代码。

您无需从0-1构建veadk项目，推荐使用agentkit-cli，从Basic Agent App模版来创建项目(模板使用VeADK框架)，在模版创建完成后，你需要做以下修改：
- 为智能体添加代码执行工具 `run_code`
- 配置环境变量 `AGENTKIT_TOOL_ID` 为您的沙箱工具实例 ID
最终，您的代码文件应该如下：

### 完整代码
将代码保存为`simple_agent_tool.py`

```python
from veadk import Agent, Runner
import logging
from veadk.tools.builtin_tools.run_code import run_code
from agentkit.apps import AgentkitSimpleApp

logger = logging.getLogger(__name__)

# 创建应用实例
app = AgentkitSimpleApp()

# 创建智能体，集成 run_code 工具
agent: Agent = Agent(
    tools=[run_code],  # 添加代码执行工具
)

# 创建运行器
runner = Runner(agent=agent)

@app.entrypoint
async def run(payload: dict, headers: dict) -> str:
    """智能体入口函数，处理用户请求"""
    prompt = payload["prompt"]
    user_id = headers["user_id"]
    session_id = headers["session_id"]

    logger.info(
        f"Running agent with prompt: {prompt}, user_id: {user_id}, session_id: {session_id}"
    )
    
    # 运行智能体，自动处理工具调用
    response = await runner.run(
        messages=prompt, 
        user_id=user_id, 
        session_id=session_id
    )

    logger.info(f"Run response: {response}")
    return response

@app.ping
def ping() -> str:
    """健康检查接口"""
    return "pong!"

if __name__ == "__main__":
    # 启动本地开发服务器
    app.run(host="0.0.0.0", port=8000)
```

### 代码说明

- **run_code 工具**：提供安全的代码执行环境，支持 Python、JavaScript 等多种编程语言
- **session_id**：用于标识用户会话，同一 session_id 的请求将共享沙箱实例
- **异步处理**：使用 `async/await` 语法支持高并发请求
## 本地调试
### 1. 官方源安装VeADK

您可以直接使用 Python 包管理工具 pip 从 PyPI 平台 来安装 [veadk-python](https://volcengine.github.io/veadk-python/introduction/installation)：

```bash
# 正式环境源安装veADK
pip install veadk-python

# 支持调用tools的veadk官方源版本尚未发布（预计1030发布），请先使用git源码方式安装。
pip install veadk-python@git+https://github.com/volcengine/veadk-python.git
```
> **说明**：支持调用built-in-tools的veadk-python版本为0.2.15及以上。

### 2. 配置环境变量

在启动智能体之前，需要配置以下环境变量：

```bash
# 必需配置：沙箱工具 ID（从控制台获取）
export AGENTKIT_TOOL_ID=t-ye7fhfmghsc1kdxxxxxx

# 必需配置：火山引擎访问凭证
export VOLCENGINE_ACCESS_KEY=your_ak
export VOLCENGINE_SECRET_KEY=your_sk

# 必需配置：模型相关配置
export MODEL_AGENT_NAME=your_model_name
export MODEL_AGENT_API_KEY=your_model_api_key
```

**📝 注意事项：**

- 请将 `your_ak`、`your_sk` 等占位符替换为您的实际配置值
- `AGENTKIT_TOOL_ID` 从火山引擎控制台创建沙箱工具后获取

### 3. 本地启动智能体服务

配置完环境变量后，运行以下命令启动智能体：

```bash
python simple_agent_tool.py
```

服务启动成功后，将监听 `http://0.0.0.0:8000`，您可以通过该地址调用智能体。
### 4. 调用智能体

#### Session ID 机制说明

Built-in Tools 采用智能的会话管理机制：

- **自动创建**：首次使用某个 `session_id` 调用时，系统会自动创建对应的沙箱会话实例
- **会话复用**：相同 `session_id` 的多次请求将共享同一个沙箱实例，保持代码执行的上下文连续性
- **生命周期**：每个会话实例默认有效期为 30 分钟，超时后自动销毁
- **隔离性**：不同 `session_id` 的请求使用独立的沙箱环境，互不干扰

#### 调用示例
使用以下 curl 命令测试智能体的代码执行能力：

```bash
curl --location 'http://localhost:8000/invoke' \
  --header 'Content-Type: application/json' \
  --header 'user_id: veadk-test' \
  --header 'session_id: local_session' \
  --data '{"prompt": "给我在50和100之间一个随机的质数"}'
```

**参数说明：**

- `user_id`：用户标识符
- `session_id`：会话标识符，用于关联沙箱实例
- `prompt`：用户的自然语言请求

#### 执行日志示例

调用成功后，控制台会输出详细的执行日志：
```
2025-10-24 14:50:23 | DEBUG | runner.py:265 - Auto create session: local_session, user_id: veadk-test, app_name: veadk_default_app
2025-10-24 14:50:53 | DEBUG | runner.py:280 - Function call: id='call_1w6gamjirm56uvi8kl8dc0hr' args={'code': 'import random\nimport math\n\ndef is_prime(n):\n    if n <= 1:\n        return False\n    if n == 2:\n        return True\n    if n % 2 == 0:\n        return False\n    for i in range(3, int(math.sqrt(n)) + 1, 2):\n        if n % i == 0:\n            return False\n    return True\n\nprimes = [n for n in range(50, 101) if is_prime(n)]\nrandom_prime = random.choice(primes)\nprint(random_prime)', 'language': 'python3'} name='run_code'
2025-10-24 14:50:53 | DEBUG | run_code.py:41 - Running code in language: python3, session_id=local_session
2025-10-24 14:51:08 | DEBUG | run_code.py:68 - Invoke run code response: {'ResponseMetadata': {'RequestId': '', 'Action': 'InvokeTool', 'Version': '2025-10-30', 'Service': '', 'Region': ''}, 'Result': {'ToolId': 't-ye7i0e39c0c1kdxxxxxx', 'UserSessionId': 'local_session', 'SessionId': 's-ye7kmw6ps0c1kdxxxxxx', 'Endpoint': 'xxx', 'InternalEndpoint': '', 'Result': '{\n  "success": true,\n  "message": "Code executed successfully",\n  "data": {\n    "kernel_name": "python3",\n    "session_id": "xxxx",\n    "status": "ok",\n    "execution_count": 1,\n    "outputs": [\n      {\n        "output_type": "stream",\n        "name": "stdout",\n        "text": "83\\n",\n        "data": null,\n        "metadata": {},\n        "execution_count": null,\n        "ename": null,\n        "evalue": null,\n        "traceback": null\n      }\n    ],\n    "code": "import random\\nimport math\\n\\ndef is_prime(n):\\n    if n \\u003c= 1:\\n        return False\\n    if n == 2:\\n        return True\\n    if n % 2 == 0:\\n        return False\\n    for i in range(3, int(math.sqrt(n)) + 1, 2):\\n        if n % i == 0:\\n            return False\\n    return True\\n\\nprimes = [n for n in range(50, 101) if is_prime(n)]\\nrandom_prime = random.choice(primes)\\nprint(random_prime)",\n    "msg_id": "c4a5f58d-7c9b8b8a17118fe6d1c65aae_94_2"\n  }\n}'}}
2025-10-24 14:51:24 | DEBUG | runner.py:288 - Event output: 在50和100之间随机生成的质数为：83。

（注：通过Python代码筛选50-100间的质数列表[53, 59, 61, 67, 71, 73, 79, 83, 89, 97]，并随机选择得到结果。）
2025-10-24 14:51:24 | WARNING | runner.py:332 - No tracer is configured in the agent, no trace id provided.
INFO:     127.0.0.1:58727 - "POST /invoke HTTP/1.1" 200 OK
```

## 部署到生产环境

完成本地开发和测试后，您可以将智能体部署到 Agentkit 平台：

1. **打包代码**：确保所有依赖都已正确配置在 `requirements.txt` 中
2. **平台部署**：参考Runtime [快速开始](../1.introduction/3.quickstart.md) 部分部署tool，主要有以下几步：
    - 在项目根目录运行 `agentkit init` 命令，初始化项目，会生成 `agentkit.yaml` 文件（如果前面已执行，跳过此步）
    - 确保`agentkit.yaml`文件配置，应用入口设置为您刚才已经调通的应用代码`simple_agent_tool.py`，即：
    ```yaml
    entry_point: simple_agent_tool.py
    ```
    - 确保所有依赖都已正确配置在 `requirements.txt` 中
    - 根据[快速开始]指南，通过`agentkit config`和`agentkit launch`命令，配置和部署应用。
3. **调用应用**：部署完成后，您可以通过平台提供的 API 或 SDK 调用智能体。调用示例：
    ```bash
    agentkit invoke "给我在50和100之间一个随机的质数"
    ```

---

## 常见问题

### Q: 如何查看沙箱支持的编程语言？
A: 当前支持 Python3、JavaScript 等主流语言，具体支持列表请参考工具文档。

### Q: Session 超时后的数据会保留吗？
A: 不会。Session 超时后，沙箱实例及其中的所有数据都会被清理，下次请求会创建新的实例。

### Q: 如何处理长时间运行的任务？
A: 建议将长时间任务拆分为多个步骤，或考虑使用异步任务队列方案。

---
